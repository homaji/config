"####Settings####

set runtimepath=~/vimperator

"エディターのパスを設定
set editor="%VIM%/gvim.exe -f\ --remote-tab-wait-silent"

"GUIの設定
"旧バージョンでの表記
"set guioptions=mnr
set toolbars=noaddons,nonavigation

"タブの追加ボタンを非表示
"style chrome://* .tabs-newtab-button { display: none;}

set status=input,location,position

"Beepについて
set visualbell
hi Bell display: none;

"vimperatorrcの再読込"
map <silent> <Leader>R :mapc<CR>:cmapc<CR>:imapc<CR>:source ~/_vimperatorrc<CR>

"はてなブックマークプラグインを使う
"http://wiki.github.com/hatena/hatena-bookmark-xul/vimperator
javascript if (typeof hBookmark != 'undefined') liberator.loadScript('chrome://hatenabookmark/content/vimperator/plugin/hatenabookmark.js', {__proto__: this});

"http://retlet.net/log/2008/06/awesomebar-bookmarklet.html

set! browser.urlbar.filter.javascript=false
set! browser.urlbar.maxRichResults=10

"tabを押さなくても補完する
"set wildoptions=auto
"補完リストはサーチエンジンとロケーションバーの履歴
"Hははてぶ。上で読み込んだあとに利用する。
set complete=tslbS

"hintでmigemoを利用する
"http://unsigned.g.hatena.ne.jp/Trapezoid/20080616/1213624179
"set hintmatching=custom

"hintでcharhintを使用できるよう設定
set hintchars="ABCDEFGHIJKLMNOPQRSTUVWXYZ"


"起動時にCSSを読み込む。場所は~/vimperator/colors
"http://d.hatena.ne.jp/teramako/20081031/p1

"js <<EOM
"(function(){
"var colorDir = io.getRuntimeDirectories("colors")[0];
"io.readDirectory(colorDir).forEach(function(file){
"  if (/\.css$/i.test(file.path)) io.source(file.path, false);
"});
"})();
"EOM

"####Mappings####
"Leaderの設定"
let mapleader='\'

"css削除
map	!	:set invum<CR>

"####move####
noremap	j	5j
noremap	k	5k
noremap J	<C-d>
noremap K	<C-u>

"####Tabs####
nnoremap s <Nop>
nnoremap sn gt
nnoremap sp gT

"###for skk ###
map <C-j> <Nop>
cmap <C-j> <Nop>

"### Showing Images###
nnoremap x :set! permissions.default.image=2<cr>
nnoremap X :set! permissions.default.image=1<cr>

"### Toggle Javascript###
" map  :set! javascript.enabled=false<CR>
" map  :set! javascript.enabled=true<CR>


" Add Mapping <C-c> copy or stop loading
"<C-c>で選択範囲のコピーと読み込みの中断
"http://vimperator.g.hatena.ne.jp/teramako/20090629/1246288372

javascript <<EOF
mappings.addUserMap([modes.NORMAL,modes.VISUAL],['<C-c>'], 'Copy selected text or stop loading',
  function(){
    var sel = document.commandDispatcher.focusedWindow.getSelection().toString();
    if (sel){
      util.copyToClipboard(sel,true);
    } else {
      window.BrowserStop();
      liberator.echomsg('Stopped loading !', 5);
    }   
  },{ rhs: 'Copy selected text or stop loading' }
);
EOF


" block referer
autocmd LocationChange .* 	set! network.http.sendRefererHeader=2
autocmd LocationChange reader\.livedoor\.com/reader 	set! network.http.sendRefererHeader=0
autocmd LocationChange fastladder\.com/reader 		set! network.http.sendRefererHeader=1
autocmd LocationChange localhost   			set! network.http.sendRefererHeader=0
autocmd LocationChange 127\.0\.0\.1  			set! network.http.sendRefererHeader=0
autocmd LocationChange www\.google\.co\.jp 		set! network.http.sendRefererHeader=0

 

"####Plugin####

"Ime_controller.js
let g:ex_ime_mode = "inactive"
let g:textarea_ime_mode = "inactive"

"clock.js
"http://d.hatena.ne.jp/janus_wel/20081128/1227849365
"let clock_format='[%d %t]'

"feedSomeKeys_3.js
command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
lazy fmaps -u='mail\.google\.com/mail' c / j k n p o u e x s r a # [ ] ? gi gs gt gd ga gc
lazy fmaps -u='mail\.google\.com/mail/.*/[0-9a-f]+$' c / j,n k,p n,j p,k o u e x s r a # [ ] ? gi gs gt gd ga gc
lazy fmaps -u='www\.google\.co\.jp/reader' -events=vkeypress j k n p m s v A r S N P X O gh ga gs gt gu u / ? J K
lazy fmaps -u='www\.google\.com/reader' -events=vkeypress j k n p m s v A r S N P X O gh ga gs gt gu u / ? J K


"はてなブックマーク
javascript if (typeof hBookmark != 'undefined') liberator.loadScript('chrome://hatenabookmark/content/vimperator/plugin/hatenabookmark.js', {__proto__: this});

"togller.js
"http://d.hatena.ne.jp/teramako/20081130/p1
js <<EOM
liberator.globalVariables.toggler = {
  side: ["sbclose", "sbar HBookmarkSidebar"]
};
EOM

"AppendAnchor.js
let g:auto_append_anchor = "true"

"Next Link
"AutoPagelizeっぽくせずに次のページへのリンクを探して読み込む
"let g:nextlink_followlink = "true"
set nextpattern=^次(へ|の|ペ)?,^続き,ＮＥＸＴ,^過去の?,(next|more),^(>>*|») 
set previouspattern=^前(へ|の|ペ)?,^戻る,ＢＡＣＫ,^最新の?,(prev|previous),^(<<*|«) 
let g:nextlink_nositeinfo_act = "e"
